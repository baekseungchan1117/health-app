<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <title>FitTrack</title>
    <!--axios-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- 폰트어썸 -->
    <script src="https://kit.fontawesome.com/693f483c38.js" crossorigin="anonymous"></script>
    <!--파비콘-->
    <!--<link rel="shortcut icon" href="favicon.ico" />-->
    <link rel="icon" href="./favicon.png" />
    <!--브라우저 스타일 초기화-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css" />
    <!--Google Fonts - 나눔고딕-->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet" />
    <!--Google Material Icons-->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />

    <link rel="stylesheet" href="./css/main.css" />

    <!--GSAP & ScrollToPlugin-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"
        integrity="sha512-IQLehpLoVS4fNzl7IfH8Iowfm5+RiMGtHykgZJl9AWMgqx0AmJ6cRWcB+GaGVtIsnC4voMfm8f2vwtY+6oPjpQ=="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/ScrollToPlugin.min.js"
        integrity="sha512-nTHzMQK7lwWt8nL4KF6DhwLHluv6dVq/hNnj2PBN0xMl2KaMm1PM02csx57mmToPAodHmPsipoERRNn4pG7f+Q=="
        crossorigin="anonymous"></script>

    <!--Swiper-->
    <link rel="stylesheet" href="https://unpkg.com/swiper@6.8.4/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper@6.8.4/swiper-bundle.min.js"></script>
    <!--ScrollMagic-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.8/ScrollMagic.min.js"></script>
    <script defer src="./js/main.js"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />


    <link href="https://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet">

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>


    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3e8d530572b469cd48ffa7479b0a18a1&libraries=services,clusterer,drawing"></script>

<body>

    <!--Hey! This is the original version
of Simple CSS Waves-->
    <div class="header">
        <!--Content before waves-->
        <div class="inner-header flex">
        </div>
        <!--Waves Container-->
        <div>
            <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                viewBox="0 24 180 28" preserveAspectRatio="none" shape-rendering="auto">
                <defs>
                    <path id="gentle-wave"
                        d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
                </defs>
                <g class="parallax">
                    <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7" />
                    <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
                    <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
                    <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
                </g>
            </svg>
        </div>
        <!--Waves end-->
    </div>
    <!--Header ends-->
    <!--Content starts-->
    <!--Content ends-->
    <div class="view">
        <div class="mobile-view">
            <div class="wrap">
                <div class="before-line"></div>
                <section name="map" id="map_section">
                    <button type="button" onclick="mapClose()" class="map_close_button">
                        <span class="material-symbols-outlined">
                            close
                        </span></button>
                    <div id="map"></div>
                </section>
                <div class="main-view">
                    <div class="main-view-wrap">
                        <header>
                            <!--NOTICE LINE-->
                            <div class="notice-line">
                                <div class="inner">
                                    <div class="inner__left">
                                        <div class="swiper-container">
                                            <div class="swiper-wrapper">
                                                <div class="swiper-slide">
                                                    <a href="javascript:void(0)">FitTrack Validated App Your Partner</a>
                                                </div>
                                                <div class="swiper-slide">
                                                    <a href="javascript:void(0)">Accumulated 30,000!!!</a>
                                                </div>
                                                <div class="swiper-slide">
                                                    <a href="javascript:void(0)">Please join FitTrack</a>
                                                </div>
                                                <div class="swiper-slide">
                                                    <a href="javascript:void(0)">From exercise to diet Good!!</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="logo-category-btn-box">
                                <div class="logo">
                                    <img src="./images/Logo.png" alt="ffd">
                                </div>
                                <div class="welcomeUser">환영합니다</div>
                            </div>
                            <div class="categoty-menu"></div>
                        </header>

                        <main>
                            <div class="scrollControl">
                                <div class="center_select_box">
                                    <button class="center_select_box search_button" type="button"
                                        onclick="sample4_execDaumPostcode()">
                                        <div>
                                            헬스장 검색
                                        </div>
                                        <span class="material-icons">search</span>
                                        <span id="guide" style="color: #999; display: none"></span>
                                    </button>
                                </div>

                                <div class="text">
                                    <p style="color: purple;font-weight: bolder;">우리 변화해 볼까?</p>
                                    <p>지금부터 운동 시작</p>
                                </div>


                                <div class="middleButton">
                                    <button id="foot">
                                        <button class="button button-os"><a href="/qrcode"><i class="fa-solid fa-qrcode"
                                                    style="color: #000000;"></i> QR</a></button>
                                    </button>
                                    <button id="foot2">
                                        <button class="button button-os2" style="right: 0;"><a
                                                href="/exam">calorie</a></button>
                                    </button>
                                </div>

                                <!-- 칼로리 테이블 -->

                                <div class="ptable">
                                    <h1 class="headin" style="color: black;">Today's calories</h1>
                                    <table>
                                        <tr class="col">
                                            <th>Food</th>
                                            <th>Calories</th>
                                        </tr>
                                        <tr class="wpos">
                                            <td>Goals</td>
                                            <td>
                                                <% if(goalsValue !==null){ %>
                                                    <% if(goalsValue.Kcal !==0){ %>
                                                        <div class="display_flex_around">
                                                            <div class="widthset">
                                                                <%= goalsValue.Kcal %> Kcal
                                                            </div>
                                                            <% } %>
                                                                <% } %>

                                                                    <% if(goalsValue==null){ %>
                                                                        <div>설정 X</div>
                                                                        <% } %>
                                                                            <% if(goalsValue !==null){ %>
                                                                                <% if(goalsValue.Kcal==0 ||
                                                                                    goalsValue.Protein==0){ %>
                                                                                    <div>설정 X</div>
                                                                                    <% } %>
                                                                                        <% } %>
                                            </td>
                                            </td>
                                        </tr>
                                        <tr class="wpos">
                                            <td>Today</td>
                                            <td>
                                                <% if(NutritionTotal.KcalResult !==null){ %>
                                                    <% if(NutritionTotal.KcalResult !==0){ %>
                                                        <div class="display_flex_around">
                                                            <div class="widthset">
                                                                <%= NutritionTotal.KcalResult %> Kcal
                                                            </div>
                                                            <% } %>
                                                                <% } %>

                                                                    <% if(NutritionTotal.KcalResult==null){ %>
                                                                        <div>설정 X</div>
                                                                        <% } %>
                                                                            <% if(NutritionTotal.KcalResult !==null){ %>
                                                                                <% if(NutritionTotal.KcalResult==0 ||
                                                                                    NutritionTotal.KcalResult==0){ %>
                                                                                    <div>설정 X</div>
                                                                                    <% } %>
                                                                                        <% } %>
                                            </td>
                                            </td>
                                        </tr>
                                        <tr class="pos">
                                            <td>Result</td>
                                            <td>
                                                <% if(goalsValue !==null){ %>
                                                    <% if(goalsValue.Kcal !==0){ %>
                                                        <div class="display_flex_around">
                                                            <div class="widthset">
                                                                <%= goalsValue.Kcal-NutritionTotal.KcalResult %> Kcal
                                                            </div>
                                                            <% } %>
                                                                <% } %>

                                                                    <% if(goalsValue==null){ %>
                                                                        <div>설정 X</div>
                                                                        <% } %>
                                                                            <% if(goalsValue !==null){ %>
                                                                                <% if(goalsValue.Kcal==0 ||
                                                                                    goalsValue.Protein==0){ %>
                                                                                    <div>설정 X</div>
                                                                                    <% } %>
                                                                                        <% } %>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="awards">
                                    <div class="inner">
                                        <div class="swiper-container">
                                            <div class="swiper-wrapper">
                                                <div class="swiper-slide">
                                                    <img src="./images/SCAN_20230508_172149588.jpeg" alt="" />
                                                </div>
                                                <div class="swiper-slide">
                                                    <img src="./images/images.jpeg" alt="" />
                                                </div>
                                                <div class="swiper-slide">
                                                    <img src="./images/다운로드.jpeg" alt="" />
                                                </div>
                                            </div>
                                        </div>

                                        <!-- <div class="swiper-prev">
                                                        <span class="material-icons">arrow_back</span>
                                                    </div>
                                                    <div class="swiper-next">
                                                        <span class="material-icons">arrow_forward</span>
                                                    </div> -->
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                    <footer>
                        <div class="inner">
                            <ul class="home">
                                <span class="material-symbols-outlined">
                                    <i class="fa-sharp fa-solid fa-house" style="color: #000000"></i>
                                </span>
                                <div>Home</div>
                            </ul>
                            <a href="http://localhost:8000/">
                                <ul class="community">
                                    <span class="material-symbols-outlined">
                                        <i class="fa-solid fa-clipboard" style="color: #000000"></i>
                                    </span>
                                    <div>Bord</div>
                                </ul>
                            </a>
                            <a href="http://localhost:8005/">
                                <ul class="community-chat">
                                    <span class="material-symbols-outlined">
                                        <i class="fa-solid fa-comment" style="color: #000000"></i>
                                    </span>
                                    <div>Chat</div>
                                </ul>
                            </a>
                            <ul class="setting">
                                <span class="material-symbols-outlined">
                                    <i class="fa-solid fa-user" style="color: #000000"></i>
                                </span>
                                <% if (loggedIn) { %>
                                    <li><button onclick="logout()" id="logoutLink"
                                            style="border:none; background: none;">Logout</button></li>
                                    <% } else { %>
                                        <li><button onclick="login()" id="loginLink">Login</button></li>
                                        <% } %>
                            </ul>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="/js/login.js"></script>
<script>
    const categoryBtn = document.querySelector('.category-btn');
    const categoryMenu = document.querySelector('.categoty-menu');

    categoryBtn.addEventListener('click', function () {
        categoryMenu.classList.toggle('slide-in');
    });


    function searchResult() {
        const mainForm = document.forms["mainForm"];
        const searchResultTableTr = document.querySelector("#searchResultTableTr");

        axios({
            method: "POST",
            url: "/NutritionSearchResult",
            data: {
                whatFoodeat: mainForm.whatFoodeat.value,
                howManyEat: mainForm.howManyEat.value,
            },
        })
            .then((res) => {
                return res.data;
            })
            .then((data) => {
                console.log(data);
                const inTableHtml = `
                <tr id="eats${data.id}" >
                    <td>${data.foodName}</td>
                    <td>${mainForm.howManyEat.value}</td>
                    <td>${data.Kcal}</td>
                    <td>${data.Protein}</td>
                </tr>
              `;
                searchResultTableTr.innerHTML = inTableHtml
            });
    }
</script>


<!-- daum search API-->
<script>
    function sample4_execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function (data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 도로명 주소의 노출 규칙에 따라 주소를 표시한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var roadAddr = data.roadAddress; // 도로명 주소 변수
                var extraRoadAddr = ""; // 참고 항목 변수

                // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                if (data.bname !== "" && /[동|로|가]$/g.test(data.bname)) {
                    extraRoadAddr += data.bname;
                }
                // 건물명이 있고, 공동주택일 경우 추가한다.
                if (data.buildingName !== "" && data.apartment === "Y") {
                    extraRoadAddr +=
                        extraRoadAddr !== ""
                            ? ", " + data.buildingName
                            : data.buildingName;
                }
                // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                if (extraRoadAddr !== "") {
                    extraRoadAddr = " (" + extraRoadAddr + ")";
                }

                var guideTextBox = document.getElementById("guide");
                // 사용자가 '선택 안함'을 클릭한 경우, 예상 주소라는 표시를 해준다.
                if (data.autoRoadAddress) {
                    var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
                    guideTextBox.innerHTML = "(예상 도로명 주소 : " + expRoadAddr + ")";
                    guideTextBox.style.display = "block";
                } else if (data.autoJibunAddress) {
                    var expJibunAddr = data.autoJibunAddress;
                    guideTextBox.innerHTML = "(예상 지번 주소 : " + expJibunAddr + ")";
                    guideTextBox.style.display = "block";
                } else {
                    guideTextBox.innerHTML = "";
                    guideTextBox.style.display = "none";
                }
                KAKAOMAP(roadAddr);
            },
        }).open();
    }
</script>


<!-- KAKAO MAP API -->
<script>
    function KAKAOMAP(search) {
        const map_section = document.getElementById("map_section")
        const mainview = document.querySelector(".main-view")

        const option = {
            location,
            radious: 10000,
            sort: kakao.maps.services.SortBy.DISTANCE,
        };



        var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

        var mapContainer = document.getElementById("map"), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                level: 3, // 지도의 확대 레벨
            };
        // 지도를 생성합니다
        var map = new kakao.maps.Map(mapContainer, mapOption);

        setTimeout(function () { map.relayout(); }, 0);

        mapContainer.style.display = 'block'
        map_section.style.display = 'block'
        mainview.style.display = 'none'
        // 장소 검색 객체를 생성합니다
        var ps = new kakao.maps.services.Places();

        // 주소-좌표 변환 객체를 생성합니다
        var geocoder = new kakao.maps.services.Geocoder();


        // 주소로 좌표를 검색합니다
        geocoder.addressSearch(search, function (result, status) {
            // 정상적으로 검색이 완료됐으면
            if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                const lating = new kakao.maps.LatLng(result[0].y, result[0].x);
                option.location = lating;

                // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                map.setCenter(coords);
            }
            // 키워드로 장소를 검색합니다
            ps.keywordSearch("헬스장", placesSearchCB, option);

            // 키워드 검색 완료 시 호출되는 콜백함수 입니다
            function placesSearchCB(data, status, pagination) {
                if (status === kakao.maps.services.Status.OK) {
                    // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
                    // LatLngBounds 객체에 좌표를 추가합니다
                    var bounds = new kakao.maps.LatLngBounds();

                    for (var i = 0; i < data.length; i++) {
                        displayMarker(data[i]);
                        bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                    }
                }
            }

            // 지도에 마커를 표시하는 함수입니다
            function displayMarker(place) {
                // 마커를 생성하고 지도에 표시합니다
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: new kakao.maps.LatLng(place.y, place.x),
                });

                // 마커에 클릭이벤트를 등록합니다
                kakao.maps.event.addListener(marker, "click", function () {
                    // 마커를 클릭하면 장소명이 인포윈도우에 표출됩니다
                    infowindow.setContent(
                        '<div style="padding:5px;font-size:12px;">' +
                        place.place_name +
                        "</div>"
                    );
                    infowindow.open(map, marker);

                });
            }
        });
    }

    function mapClose() {
        document.getElementById("map").style.display = "none"
        document.getElementById("map_section").style.display = "none"
        document.querySelector(".main-view").style.display = "block"
    }
</script>

</html>